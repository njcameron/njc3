<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="keywords" content="Drupal, contractor, London, consultant, Angular, freelancer, Ruby on Rails" class="ng-scope">
<meta name="description" content="Technology consultant based in London working with organisations large and small to deliver brilliant products with rails, drupal and agile.">
<meta property="og:title" content="Managing Drupal 7 dependencies with Composer" />
<meta property="og:description" content="(Don&rsquo;t want to read? Check the example project on Github)
Working with Angular JS, Bower and Grunt, and in particular how they work with third party dependencies, has got me thinking about how to manage a drupal codebase.
Since the SVN days I&rsquo;ve always simply committed the whole docroot into the repo and ensure that the sites/default/files, settings.php and other bits are ignored. There are several benefits to this: it&rsquo;s simple, easy to understand and ensures all contrib modules and libraries &ldquo;just work&rdquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://neilcameron.me/posts/d7-composer/" />



<meta property="article:published_time" content="2015-10-09T17:02:09&#43;01:00"/>

<meta property="article:modified_time" content="2015-10-09T17:02:09&#43;01:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Managing Drupal 7 dependencies with Composer"/>
<meta name="twitter:description" content="(Don&rsquo;t want to read? Check the example project on Github)
Working with Angular JS, Bower and Grunt, and in particular how they work with third party dependencies, has got me thinking about how to manage a drupal codebase.
Since the SVN days I&rsquo;ve always simply committed the whole docroot into the repo and ensure that the sites/default/files, settings.php and other bits are ignored. There are several benefits to this: it&rsquo;s simple, easy to understand and ensures all contrib modules and libraries &ldquo;just work&rdquo;."/>



    <link rel="canonical" href="https://neilcameron.me/posts/d7-composer/">

    <title>
      
        Managing Drupal 7 dependencies with Composer | London consultant: rails, agile, drupal, tech, startups.
      
    </title>

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link href="/css/style.css" rel="stylesheet">

    

    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62883841-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


    
  </head>
  <body>
    
      <header class="blog-header">
    <nav class="navbar d-block d-sm-none">
        <button class="navbar-toggler toggler-example" type="button" data-toggle="collapse" data-target="#navbarSupportedContent1" aria-controls="navbarSupportedContent1"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="icon-navicon">&nbsp;</span>
        </button>
    </nav>
</header>
<div class="collapse navbar-collapse" id="navbarSupportedContent1">
    <ul class="navbar-nav">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="/#about">About me</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="/#help">How I can help</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="/#recent">Recent work</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="/#blog">Blog</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="/#contact">Contact</a>
        </li>
        
    </ul>
</div>
    

    
    





<div class="container-fluid">
  <div class="row">
    <div class="blog-post-image">
      <picture>
        <source media="(min-width: 1200px)" srcset="/posts/d7-composer/composer_huabab1b1d5b012089b2d726745c89329b_1281053_1800x800_fill_q90_box_top.jpg">
        <source media="(min-width: 768px)" srcset="/posts/d7-composer/composer_huabab1b1d5b012089b2d726745c89329b_1281053_1200x800_fill_q90_box_top.jpg">
        <source media="(min-width: 576px)" srcset="/posts/d7-composer/composer_huabab1b1d5b012089b2d726745c89329b_1281053_600x350_fill_q90_box_top.jpg">

        <img src="/posts/d7-composer/composer_huabab1b1d5b012089b2d726745c89329b_1281053_1800x800_fill_q90_box_top.jpg">
      </picture>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="blog-post-container col-md-9 col-sm-12">
      <header>
        <h1>Managing Drupal 7 dependencies with Composer</h1>
        <h5>


    9 Oct 2015
 // 
    
      <span class="tag">Drupal</span>
    
</h5>
      </header>
      <article class="blog-post">
        <div class="undertitle">
          <p>
            Composer brings dependency management for Drupal 7 kicking and screaming into 2015, this is how you can effectively use it on your next project.
          </p>
        </div>
        <p>(Don&rsquo;t want to read? Check the <a href="https://github.com/njcameron/drupal-composer-template">example project on Github</a>)</p>

<p>Working with Angular JS, Bower and Grunt, and in particular how they work with third party dependencies, has got me thinking about how to manage a drupal codebase.</p>

<p>Since the SVN days I&rsquo;ve always simply committed the whole docroot into the repo and ensure that the sites/default/files, settings.php and other bits are ignored. There are several benefits to this: it&rsquo;s simple, easy to understand and ensures all contrib modules and libraries &ldquo;just work&rdquo;.</p>

<p>However, there are some downsides too: the repo gets very big very quickly, module updates often pollute the commit history and it blurs the line between 3rd party dependencies and custom modules.</p>

<p>I started looking for a solution whereby all 3rd party dependencies would be <em>built</em> rather than checked out.</p>

<p>I quickly ran into the <a href="https://www.drupal.org/node/2471553">Drush Make vs. Composer</a> discussion. tl;dr use composer, drush make is too drupally and composer is the future.</p>

<blockquote>
<p>tl;dr use composer, drush make is too drupally and composer is the future.</p>
</blockquote>

<p>Then I started down the path of actually trying to use Composer to manage my application code. My requirements were quite specific:</p>

<ul>
<li>Everything must live in a single repository.</li>
<li>Core and contrib must be pulled in via composer on install.</li>
<li>The app must build with no manual intervention.</li>
</ul>

<p>The <a href="https://github.com/drupal-composer/drupal-project/tree/7.x">Drupal Composer project</a> quickly gets you started. The main problem I ran into is how to handle custom themes and modules. The <a href="https://getcomposer.org/doc/05-repositories.md#loading-a-package-from-a-vcs-repository">suggested</a> way seems to be including them as a package from a VCS repository. The problem with this is that you need two repos: one for the custom modules and one for the composer files. This is going to lead to confusion pretty quickly and I&rsquo;m sure devops have enough to do without maintaining scripts to access multiple repos.</p>

<p>I eventually settled for a repo structure that looks like:</p>

<p>|_ composer.json<br />
|_ composer.lock<br />
|_ .gitignore<br />
|_ web/sites/all/modules/custom<br />
|_ web/sites/all/modules/features<br />
|_ web/sites/all/modules/custom<br />
|_ web/sites/all/themes/custom<br />
|_ scripts</p>

<p>/web is the docroot for the site. Composer pulls in all the dependencies into this directory.</p>

<p>The directories within /web do not get overridden because of the preserve path composer plugin. <a href="https://github.com/derhasi/composer-preserve-paths">https://github.com/derhasi/composer-preserve-paths</a></p>

<p>/scripts is used to keep Composer scripts (<a href="https://getcomposer.org/doc/articles/scripts.md">https://getcomposer.org/doc/articles/scripts.md</a>) e.g. after composer install create a files directory and settings.php.</p>

<p>Initially I was unsure of this setup as Composer <a href="https://getcomposer.org/doc/faqs/should-i-commit-the-dependencies-in-my-vendor-directory.md">makes quite clear</a> that dependencies should not be added to the repo. However, looking at how Pantheon <a href="https://github.com/pantheon-systems/example-drupal7-travis-composer/tree/master#repository-management">recommend</a> you approach Composer for Drupal gave me confidence in this and compared to other options  it provides a transparent and easy to manage approach.</p>

<p>Most of the magic happens in the .preserve paths and .gitignore file. We preserve the paths that we&rsquo;re managing with custom modules and ensure that everything except them is ignored by git.</p>

<p>I&rsquo;ve created an <a href="https://github.com/njcameron/drupal-composer-template">example project on Github</a> that shows how the whole shebang works. Let me know in the comments if you use this on your project and how you change it to make it more effective.</p>

<p>Image source: <a href="https://flic.kr/p/4dNjZS">https://flic.kr/p/4dNjZS</a></p>


        

        


      </article>
    </div>
  </div>
</div>
<div class="go-back"><a class="small button" href="/">Go back</a></div>





    

    
      

<footer class="">

</footer>

    

    
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script src="/js/site.js"></script>
  </body>
</html>
